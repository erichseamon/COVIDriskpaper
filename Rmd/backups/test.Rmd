---
title: 'test'
author: "Erich Seamon, Jennifer-Johnson Leung, Craig Miller, Ben Ridenhour"
date: "01/30/2023"
always_allow_html: yes
output:
  pdf_document:
    toc: yes
  includes:
      in_header: header.tex
  html_document:
    css: custom.css
    code_folding: hide
    highlight: textmate
    theme: united
    toc: true
    toc_float: true
params: null
mainfont: serif
header-includes:
  - \usepackage[export]{adjustbox}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width=15, fig.height=8.5)
knitr::opts_knit$set(root.dir = "/mnt/ceph/erichs/git/IMCI-covid-riskfinal/")  # with something else than `getwd()`
#knitr::opts_knit$set(root.dir = "/Users/erichseamon/Dropbox/Mac/Documents/GitHub/IMCI-covid-riskfinal/")
```


```{r covidrisk_model_pvalues, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 7, fig.height = 6, fig.align = 'center',}

library(reshape2)
library(ggplot2)
library(kableExtra)
library(plyr)

model_ideology_deaths <-readRDS("/mnt/ceph/erichs/git/IMCI-covid-riskfinal/linear_models/model_ideology_deaths.RDS")
model_ideology_deaths_delta <-readRDS("/mnt/ceph/erichs/git/IMCI-covid-riskfinal/linear_models/model_ideology_deaths_delta.RDS")
model_ideology_deaths_omicron <-readRDS("/mnt/ceph/erichs/git/IMCI-covid-riskfinal/linear_models/model_ideology_deaths_omicron.RDS")

#adjust Pvalues

cf2 <- coef(summary(model_ideology_deaths[[2]]))
cf3 <- coef(summary(model_ideology_deaths[[3]]))
cf4 <- coef(summary(model_ideology_deaths[[4]]))
cf5 <- coef(summary(model_ideology_deaths[[5]]))
cf6 <- coef(summary(model_ideology_deaths[[6]]))
cf7 <- coef(summary(model_ideology_deaths[[7]]))
cf8 <- coef(summary(model_ideology_deaths[[8]]))
cf9 <- coef(summary(model_ideology_deaths[[9]]))
cf10 <- coef(summary(model_ideology_deaths[[10]]))

cf2_delta <- coef(summary(model_ideology_deaths_delta[[2]]))
cf3_delta <- coef(summary(model_ideology_deaths_delta[[3]]))
cf4_delta <- coef(summary(model_ideology_deaths_delta[[4]]))
cf5_delta <- coef(summary(model_ideology_deaths_delta[[5]]))
cf6_delta <- coef(summary(model_ideology_deaths_delta[[6]]))
cf7_delta <- coef(summary(model_ideology_deaths_delta[[7]]))
cf8_delta <- coef(summary(model_ideology_deaths_delta[[8]]))
cf9_delta <- coef(summary(model_ideology_deaths_delta[[9]]))
cf10_delta <- coef(summary(model_ideology_deaths_delta[[10]]))

cf2_omicron <- coef(summary(model_ideology_deaths_omicron[[2]]))
cf3_omicron <- coef(summary(model_ideology_deaths_omicron[[3]]))
cf4_omicron <- coef(summary(model_ideology_deaths_omicron[[4]]))
cf5_omicron <- coef(summary(model_ideology_deaths_omicron[[5]]))
cf6_omicron <- coef(summary(model_ideology_deaths_omicron[[6]]))
cf7_omicron <- coef(summary(model_ideology_deaths_omicron[[7]]))
cf8_omicron <- coef(summary(model_ideology_deaths_omicron[[8]]))
cf9_omicron <- coef(summary(model_ideology_deaths_omicron[[9]]))
cf10_omicron <- coef(summary(model_ideology_deaths_omicron[[10]]))


#continue on for all 30 models...

newpvals <- p.adjust(c(cf2[,4], cf3[,4], cf4[,4], cf5[,4], cf6[,4], cf7[,4], cf8[,4], cf9[,4], cf10[,4], cf2_delta[,4], cf3_delta[,4], cf4_delta[,4], cf5_delta[,4], cf6_delta[,4], cf7_delta[,4], cf8_delta[,4], cf9_delta[,4], cf10_delta[,4], cf2_omicron[,4], cf3_omicron[,4], cf4_omicron[,4], cf5_omicron[,4], cf6_omicron[,4], cf7_omicron[,4], cf8_omicron[,4], cf9_omicron[,4], cf10_omicron[,4]))

cf2[,4] <- newpvals[1:16]
cf3[,4] <- newpvals[17:32]
cf4[,4] <- newpvals[33:48]
cf5[,4] <- newpvals[49:64]
cf6[,4] <- newpvals[65:80]
cf7[,4] <- newpvals[81:96]
cf8[,4] <- newpvals[97:112]
cf9[,4] <- newpvals[113:128]
cf10[,4] <- newpvals[129:144]

cf2_delta[,4] <- newpvals[145:160]
cf3_delta[,4] <- newpvals[161:176]
cf4_delta[,4] <- newpvals[177:192]
cf5_delta[,4] <- newpvals[193:208]
cf6_delta[,4] <- newpvals[209:224]
cf7_delta[,4] <- newpvals[225:240]
cf8_delta[,4] <- newpvals[241:256]
cf9_delta[,4] <- newpvals[257:272]
cf10_delta[,4] <- newpvals[273:288]

cf2_omicron[,4] <- newpvals[289:304]
cf3_omicron[,4] <- newpvals[305:320]
cf4_omicron[,4] <- newpvals[321:336]
cf5_omicron[,4] <- newpvals[337:352]
cf6_omicron[,4] <- newpvals[353:368]
cf7_omicron[,4] <- newpvals[369:384]
cf8_omicron[,4] <- newpvals[385:400]
cf9_omicron[,4] <- newpvals[401:416]
cf10_omicron[,4] <- newpvals[417:432]

coef_list <- list(cf2, cf3, cf4, cf5, cf6, cf7, cf8, cf9, cf10, cf2_delta, cf3_delta, cf4_delta, cf5_delta, cf6_delta, cf7_delta, cf8_delta, cf9_delta, cf10_delta, cf2_omicron, cf3_omicron, cf4_omicron, cf5_omicron, cf6_omicron, cf7_omicron, cf8_omicron, cf9_omicron, cf10_omicron)

#padjust additions

ado_2_P <- as.data.frame(rbind(coef_list[[1]][2:16,4], coef_list[[10]][2:16,4], coef_list[[19]][2:16,4])) 
ado_2_P$region <- "Regions 1&2"
ado_3_P <- as.data.frame(rbind(coef_list[[2]][2:16,4], coef_list[[11]][2:16,4], coef_list[[20]][2:16,4]))
ado_3_P$region <- "Region 3"
ado_4_P <- as.data.frame(rbind(coef_list[[3]][2:16,4], coef_list[[12]][2:16,4], coef_list[[21]][2:16,4]))
ado_4_P$region <- "Region 4"
ado_5_P <- as.data.frame(rbind(coef_list[[4]][2:16,4], coef_list[[13]][2:16,4], coef_list[[22]][2:16,4]))
ado_5_P$region <- "Region 5"
ado_6_P <- as.data.frame(rbind(coef_list[[5]][2:16,4], coef_list[[14]][2:16,4], coef_list[[23]][2:16,4]))
ado_6_P$region <- "Region 6"
ado_7_P <- as.data.frame(rbind(coef_list[[6]][2:16,4], coef_list[[15]][2:16,4], coef_list[[24]][2:16,4]))
ado_7_P$region <- "Region 7"
ado_8_P <- as.data.frame(rbind(coef_list[[7]][2:16,4], coef_list[[16]][2:16,4], coef_list[[25]][2:16,4]))
ado_8_P$region <- "Region 8"
ado_9_P <- as.data.frame(rbind(coef_list[[8]][2:16,4], coef_list[[17]][2:16,4], coef_list[[26]][2:16,4]))
ado_9_P$region <- "Region 9"
ado_10_P <- as.data.frame(rbind(coef_list[[9]][2:16,4], coef_list[[18]][2:16,4], coef_list[[27]][2:16,4]))
ado_10_P$region <- "Region 10"
ado_P <- rbind(ado_2_P, ado_3_P, ado_4_P, ado_5_P, ado_6_P, ado_7_P, ado_8_P, ado_9_P, ado_10_P)


#---

#--commented out below


# ado_2_P <- as.data.frame(rbind(summary(model_ideology_deaths[[2]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[2]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[2]])$coefficients[2:15,4])) 
# ado_2_P$region <- "Regions 1&2"
# ado_3_P <- as.data.frame(rbind(summary(model_ideology_deaths[[3]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[3]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[3]])$coefficients[2:15,4])) 
# ado_3_P$region <- "Region 3"
# ado_4_P <- as.data.frame(rbind(summary(model_ideology_deaths[[4]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[4]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[4]])$coefficients[2:15,4]) )
# ado_4_P$region <- "Region 4"
# ado_5_P <- as.data.frame(rbind(summary(model_ideology_deaths[[5]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[5]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[5]])$coefficients[2:15,4]) )
# ado_5_P$region <- "Region 5"
# ado_6_P <- as.data.frame(rbind(summary(model_ideology_deaths[[6]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[6]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[6]])$coefficients[2:15,4]) )
# ado_6_P$region <- "Region 6"
# ado_7_P <- as.data.frame(rbind(summary(model_ideology_deaths[[7]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[7]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[7]])$coefficients[2:15,4]) )
# ado_7_P$region <- "Region 7"
# ado_8_P <- as.data.frame(rbind(summary(model_ideology_deaths[[8]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[8]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[8]])$coefficients[2:15,4]) )
# ado_8_P$region <- "Region 8"
# ado_9_P <- as.data.frame(rbind(summary(model_ideology_deaths[[9]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[9]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[9]])$coefficients[2:15,4]) )
# ado_9_P$region <- "Region 9"
# ado_10_P <- as.data.frame(rbind(summary(model_ideology_deaths[[10]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[10]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[10]])$coefficients[2:15,4]) )
# ado_10_P$region <- "Region 10"
#ado_P <- rbind(ado_2_P, ado_3_P, ado_4_P, ado_5_P, ado_6_P, ado_7_P, ado_8_P, ado_9_P, ado_10_P)


#--end commented out

#df <- data.frame(x = seq_along(ado_P[, 1]),ado_P)
ado_P <- melt(ado_P, id.vars = "region")
ado_P$region <- as.factor(ado_P$region)
ado_P$variant <- c(rep(c("Alpha","Delta","Omicron"), 9))

#fix using different ordering
levels(ado_P$variable) <- c("Socioeconomics", "Household Composition", "Housing Type", "Unemployment", "Food Insecurity", "Broadband Access", "Diabetes", "Obesity", "Population Density", "Social Associations", "Age over 65+", "Voting", "Vaccination Rate", "Minority Status", "Uninsured Adults")

#levels(ado_P$variable) <- c("Socioeconomic Stats", "Household Composition and Disability", "Minority Status and Language", "Housing Type and Transportation", "Democratic Voting Pct", "Vaccination Rate", "Population Density", "Obesity", "Unemployment", "Uninsured Adults", "Social Associations", "Diabetes", "Food Insecurity", "Lack of Broadband Access", "Age over 65+")

ado_P_sig <- subset(ado_P, value < .05)
ado_P_sig_sort <- ado_P_sig[order(ado_P_sig$region, ado_P_sig$variant),]
#ggplot(ado_P, aes(x = variable, y = value)) + geom_point(aes(color=variant, shape = variant), size=2)+ theme_bw() +geom_hline(yintercept=.05, linetype='dotted', col = 'red') + theme(axis.text.x=element_text(angle = 90, hjust=0.95,vjust=0.2, size=10, family="serif"), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + facet_grid(region ~ .) + scale_shape(solid = FALSE)

regionz <- c("Regions 1&2", "Region 3", "Region 4", "Region 5", "Region 6", "Region 7", "Region 8", "Region 9", "Region 10")
variantz <- c("Alpha", "Delta", "Omicron")
new <- NULL
for (i in regionz){
  for (j in variantz) {
newframe <- data.frame(i, j, x = paste(as.vector(subset(ado_P_sig, variant == j & region == i)$variable), collapse = ', '))
    new <- rbind(new,newframe)
  }}

new2 <- dcast(new,i~j)
new2$i  <- factor(new2$i , levels = c("Regions 1&2", "Region 3", "Region 4", "Region 5", "Region 6", "Region 7", "Region 8", "Region 9", "Region 10"))

new2['Region Map'] <- ""

colnames(new2) <- c("Regions", "Alpha Wave", "Delta Wave", "Omicron Wave", "Region Map")

# sigtable <- new2 %>% arrange(Regions) %>% kable() %>% column_spec(2:4, width = "1.8in") %>% column_spec(5, width = "1.8in",  image=spec_image("/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region1.png", 50,50)) %>% kable_styling(full_width = FALSE, latex_options = "hold_position") 
# 
# add_header_above(sigtable, c(" ", "Significant Independent Variables" = 4))

#--modification to add images

Alphax <- new2$`Alpha Wave`
Deltax <- new2$`Delta Wave`
Omicronx <- new2$`Omicron Wave`

Alpha_R <- rbind(summary(model_ideology_deaths[[2]])[[9]],summary(model_ideology_deaths[[3]])[[9]],summary(model_ideology_deaths[[4]])[[9]],summary(model_ideology_deaths[[5]])[[9]],summary(model_ideology_deaths[[6]])[[9]],summary(model_ideology_deaths[[7]])[[9]],summary(model_ideology_deaths[[8]])[[9]],summary(model_ideology_deaths[[9]])[[9]],summary(model_ideology_deaths[[10]])[[9]])

Alpha_R <- round(Alpha_R, 2)
Alpha_R <- as.data.frame(as.character(Alpha_R))

Delta_R <- rbind(summary(model_ideology_deaths_delta[[2]])[[9]],summary(model_ideology_deaths_delta[[3]])[[9]],summary(model_ideology_deaths_delta[[4]])[[9]],summary(model_ideology_deaths_delta[[5]])[[9]],summary(model_ideology_deaths_delta[[6]])[[9]],summary(model_ideology_deaths_delta[[7]])[[9]],summary(model_ideology_deaths_delta[[8]])[[9]],summary(model_ideology_deaths_delta[[9]])[[9]],summary(model_ideology_deaths_delta[[10]])[[9]])

Delta_R <- round(Delta_R, 2)
Delta_R <- as.data.frame(as.character(Delta_R))

Omicron_R <- rbind(summary(model_ideology_deaths_omicron[[2]])[[9]],summary(model_ideology_deaths_omicron[[3]])[[9]],summary(model_ideology_deaths_omicron[[4]])[[9]],summary(model_ideology_deaths_omicron[[5]])[[9]],summary(model_ideology_deaths_omicron[[6]])[[9]],summary(model_ideology_deaths_omicron[[7]])[[9]],summary(model_ideology_deaths_omicron[[8]])[[9]],summary(model_ideology_deaths_omicron[[9]])[[9]],summary(model_ideology_deaths_omicron[[10]])[[9]])

Omicron_R <- round(Omicron_R, 2)
Omicron_R <- as.data.frame(as.character(Omicron_R))

R2 <- cbind(Alpha_R, Delta_R, Omicron_R)
R2 <- as.data.frame(R2)

Alpha_R <- R2$`as.character(Alpha_R)`
Delta_R <- R2$`as.character(Delta_R)`
Omicron_R <- R2$`as.character(Omicron_R)`

 table <- dplyr::tibble(
   Regions = c("Region 10",   "Region 9",    "Region 8",    "Region 7",    "Region 6",    "Region 5",    "Region 4",    "Region 3",    "Regions 1-2"),
   Alpha = Alphax,
   AlphaR2 = Alpha_R,
   Delta = Deltax,
   DeltaR2 = Delta_R,
   Omicron = Omicronx,
   OmicronR2 = Omicron_R,
   Map= c("\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region10.png}",
           "\\includegraphics[valign = T,width=1.90cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region9.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region8.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region7.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region6.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region5.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region4.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region3.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region1.png}"))

 table <- table[rev(rownames(table)),]
 
sigtable <- knitr::kable(table, format = "latex",  escape = FALSE, booktabs=T) %>% column_spec(c(2,4,6), width = "1in") %>% column_spec(c(3,5,7), width = ".5in") %>% column_spec(8, width = ".5in") %>% kable_styling(full_width = FALSE, latex_options = "hold_position", font_size=8)
 
#sigtable <- knitr::kable(table, format = "latex", escape = FALSE, booktabs=T)
# sigtable <- table %>% kable() %>% arrange(Regions) %>% column_spec(1:5, width = "1in") %>% kable_styling(full_width = FALSE, latex_options = "hold_position")
# #
sigtable
#add_header_above(sigtable, c(" ", "Significant Independent Variables" = 4))

```