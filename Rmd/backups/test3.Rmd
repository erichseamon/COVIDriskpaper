---
title: 'test'
author: "Erich Seamon, Jennifer-Johnson Leung, Craig Miller, Ben Ridenhour"
date: "01/30/2023"
always_allow_html: yes
output:
  pdf_document:
    toc: yes
  includes:
      in_header: header.tex
  html_document:
    css: custom.css
    code_folding: hide
    highlight: textmate
    theme: united
    toc: true
    toc_float: true
params: null
mainfont: serif
header-includes:
  - \usepackage[export]{adjustbox}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width=15, fig.height=8.5)
knitr::opts_knit$set(root.dir = "/mnt/ceph/erichs/git/IMCI-covid-riskfinal/")  # with something else than `getwd()`
#knitr::opts_knit$set(root.dir = "/Users/erichseamon/Dropbox/Mac/Documents/GitHub/IMCI-covid-riskfinal/")
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}

library(tinytex)
library(knitr)
library(kableExtra)
df <- data.frame(Variables = c("Socioeconomic Status", "Household Composition and Disability", "Minority Status", "Housing Type and Transportation", "Obesity", "Unemployment", "Uninsured Adults", "Social Associations", "Diabetes", "Food Insecurity", "Broadband Access", "Population Density", "Population Age 65+", "Democratic Voting Percentage", "Vaccination Rate", "Population adjusted COVID-19 deaths*"), Description = linebreak(c("Index which represents income, poverty, employment, and education.", "Index with represents age, single parenting, and disability.", "Index which represents race and ethnicity.","Index which represents housing structure, crowding and vehicle access.", "Number of people who are obese, at a county level.","Number of unemployed adults per county.", "Number of uninsured adults per county.", "Number of people who are members of a social organization (churches, clubs, etc).","Number of people with diabetes at a county level.", "Index indicating the relative level of food insecurity in a county.", "Number of people without broadband access.", "Population density at a county level.", "Number of people age 65 or older in a county.", "Represents voting outcomes from the 2020 presidential general election.","CDC data for two dose vaccination rates at a county level, ending in April 1, 2022.", "Population-adjusted COVID-19 deaths per county.")), Source = linebreak(c("Social Vulnerability Indices (SVI) taken from the US Census agency for toxic substances and disease registry (ATSDR)", "Social Vulnerability Indices (SVI) taken from the US Census agency for toxic substances and disease registry (ATSDR)", "Social Vulnerability Indices (SVI) taken from the US Census agency for toxic substances and disease registry (ATSDR)", "Social Vulnerability Indices (SVI) taken from the US Census agency for toxic substances and disease registry (ATSDR)", "University of Wisconsin's Population Health Institute", "University of Wisconsin's Population Health Institute","University of Wisconsin's Population Health Institute", "University of Wisconsin's Population Health Institute","University of Wisconsin's Population Health Institute", "University of Wisconsin's Population Health Institute","University of Wisconsin's Population Health Institute","2020 US Census", "2020 US Census","Massachusettes Institute of Technology's (MIT) Election Lab","US Centers for Disease Control (CDC)", "US Centers for Disease Control (CDC)")))
kable(df, col.names = c("Variables", "Description", "Data Source"), escape = F, caption = "Table T1: Variable Descriptions. * = dependent variable") %>% column_spec(3, width = "3in") %>% column_spec(c(1:2), width = "2in") %>% kable_styling(full_width = FALSE,latex_options = c("hold_position", "scale_down"), font_size = 10) %>% collapse_rows(columns = 3) 

#df %>% collapse_rows_df(Source) %>% formattable()

```

```{r covidrisk_model_pvalues_test, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 7, fig.height = 6, fig.align = 'center',}


library(reshape2)
library(ggplot2)
#library(tinytex)
library(kableExtra)
library(plyr)

model_ideology_deaths <-readRDS("/mnt/ceph/erichs/git/IMCI-covid-riskfinal/linear_models/model_ideology_deaths.RDS")
model_ideology_deaths_delta <-readRDS("/mnt/ceph/erichs/git/IMCI-covid-riskfinal/linear_models/model_ideology_deaths_delta.RDS")
model_ideology_deaths_omicron <-readRDS("/mnt/ceph/erichs/git/IMCI-covid-riskfinal/linear_models/model_ideology_deaths_omicron.RDS")


```



```{r covidrisk_model_pvalues, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 7, fig.height = 6, fig.align = 'center',}

library(reshape2)
library(ggplot2)
library(kableExtra)
library(plyr)

model_ideology_deaths <-readRDS("/mnt/ceph/erichs/git/IMCI-covid-riskfinal/linear_models/model_ideology_deaths.RDS")
model_ideology_deaths_delta <-readRDS("/mnt/ceph/erichs/git/IMCI-covid-riskfinal/linear_models/model_ideology_deaths_delta.RDS")
model_ideology_deaths_omicron <-readRDS("/mnt/ceph/erichs/git/IMCI-covid-riskfinal/linear_models/model_ideology_deaths_omicron.RDS")

ado_2_P <- as.data.frame(rbind(summary(model_ideology_deaths[[2]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[2]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[2]])$coefficients[2:15,4])) 
ado_2_P$region <- "Regions 1&2"
ado_3_P <- as.data.frame(rbind(summary(model_ideology_deaths[[3]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[3]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[3]])$coefficients[2:15,4])) 
ado_3_P$region <- "Region 3"
ado_4_P <- as.data.frame(rbind(summary(model_ideology_deaths[[4]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[4]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[4]])$coefficients[2:15,4]) )
ado_4_P$region <- "Region 4"
ado_5_P <- as.data.frame(rbind(summary(model_ideology_deaths[[5]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[5]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[5]])$coefficients[2:15,4]) )
ado_5_P$region <- "Region 5"
ado_6_P <- as.data.frame(rbind(summary(model_ideology_deaths[[6]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[6]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[6]])$coefficients[2:15,4]) )
ado_6_P$region <- "Region 6"
ado_7_P <- as.data.frame(rbind(summary(model_ideology_deaths[[7]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[7]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[7]])$coefficients[2:15,4]) )
ado_7_P$region <- "Region 7"
ado_8_P <- as.data.frame(rbind(summary(model_ideology_deaths[[8]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[8]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[8]])$coefficients[2:15,4]) )
ado_8_P$region <- "Region 8"
ado_9_P <- as.data.frame(rbind(summary(model_ideology_deaths[[9]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[9]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[9]])$coefficients[2:15,4]) )
ado_9_P$region <- "Region 9"
ado_10_P <- as.data.frame(rbind(summary(model_ideology_deaths[[10]])$coefficients[2:15,4], summary(model_ideology_deaths_delta[[10]])$coefficients[2:15,4], summary(model_ideology_deaths_omicron[[10]])$coefficients[2:15,4]) )
ado_10_P$region <- "Region 10"
ado_P <- rbind(ado_2_P, ado_3_P, ado_4_P, ado_5_P, ado_6_P, ado_7_P, ado_8_P, ado_9_P, ado_10_P)

#df <- data.frame(x = seq_along(ado_P[, 1]),ado_P)
ado_P <- melt(ado_P, id.vars = "region")
ado_P$region <- as.factor(ado_P$region)
ado_P$variant <- c(rep(c("Alpha","Delta","Omicron"), 9))

#fix using different ordering
levels(ado_P$variable) <- c("Socioeconomics", "Household Composition", "Housing Type", "Unemployment", "Food Insecurity", "Broadband Access", "Diabetes", "Obesity", "Population Density", "Social Associations", "Age over 65+", "Voting", "Vaccination Rate", "Minority Status")

#levels(ado_P$variable) <- c("Socioeconomic Stats", "Household Composition and Disability", "Minority Status and Language", "Housing Type and Transportation", "Democratic Voting Pct", "Vaccination Rate", "Population Density", "Obesity", "Unemployment", "Uninsured Adults", "Social Associations", "Diabetes", "Food Insecurity", "Lack of Broadband Access", "Age over 65+")

ado_P_sig <- subset(ado_P, value < .05)
ado_P_sig_sort <- ado_P_sig[order(ado_P_sig$region, ado_P_sig$variant),]
#ggplot(ado_P, aes(x = variable, y = value)) + geom_point(aes(color=variant, shape = variant), size=2)+ theme_bw() +geom_hline(yintercept=.05, linetype='dotted', col = 'red') + theme(axis.text.x=element_text(angle = 90, hjust=0.95,vjust=0.2, size=10, family="serif"), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + facet_grid(region ~ .) + scale_shape(solid = FALSE)

regionz <- c("Regions 1&2", "Region 3", "Region 4", "Region 5", "Region 6", "Region 7", "Region 8", "Region 9", "Region 10")
variantz <- c("Alpha", "Delta", "Omicron")
new <- NULL
for (i in regionz){
  for (j in variantz) {
newframe <- data.frame(i, j, x = paste(as.vector(subset(ado_P_sig, variant == j & region == i)$variable), collapse = ', '))
    new <- rbind(new,newframe)
  }}

new2 <- dcast(new,i~j)
new2$i  <- factor(new2$i , levels = c("Regions 1&2", "Region 3", "Region 4", "Region 5", "Region 6", "Region 7", "Region 8", "Region 9", "Region 10"))

new2['Region Map'] <- ""

colnames(new2) <- c("Regions", "Alpha Wave", "Delta Wave", "Omicron Wave", "Region Map")

# sigtable <- new2 %>% arrange(Regions) %>% kable() %>% column_spec(2:4, width = "1.8in") %>% column_spec(5, width = "1.8in",  image=spec_image("/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region1.png", 50,50)) %>% kable_styling(full_width = FALSE, latex_options = "hold_position") 
# 
# add_header_above(sigtable, c(" ", "Significant Independent Variables" = 4))

#--modification to add images

Alphax <- new2$`Alpha Wave`
Deltax <- new2$`Delta Wave`
Omicronx <- new2$`Omicron Wave`

Alpha_R <- rbind(summary(model_ideology_deaths[[2]])[[9]],summary(model_ideology_deaths[[3]])[[9]],summary(model_ideology_deaths[[4]])[[9]],summary(model_ideology_deaths[[5]])[[9]],summary(model_ideology_deaths[[6]])[[9]],summary(model_ideology_deaths[[7]])[[9]],summary(model_ideology_deaths[[8]])[[9]],summary(model_ideology_deaths[[9]])[[9]],summary(model_ideology_deaths[[10]])[[9]])

Alpha_R <- round(Alpha_R, 2)
Alpha_R <- as.data.frame(as.character(Alpha_R))

Delta_R <- rbind(summary(model_ideology_deaths_delta[[2]])[[9]],summary(model_ideology_deaths_delta[[3]])[[9]],summary(model_ideology_deaths_delta[[4]])[[9]],summary(model_ideology_deaths_delta[[5]])[[9]],summary(model_ideology_deaths_delta[[6]])[[9]],summary(model_ideology_deaths_delta[[7]])[[9]],summary(model_ideology_deaths_delta[[8]])[[9]],summary(model_ideology_deaths_delta[[9]])[[9]],summary(model_ideology_deaths_delta[[10]])[[9]])

Delta_R <- round(Delta_R, 2)
Delta_R <- as.data.frame(as.character(Delta_R))

Omicron_R <- rbind(summary(model_ideology_deaths_omicron[[2]])[[9]],summary(model_ideology_deaths_omicron[[3]])[[9]],summary(model_ideology_deaths_omicron[[4]])[[9]],summary(model_ideology_deaths_omicron[[5]])[[9]],summary(model_ideology_deaths_omicron[[6]])[[9]],summary(model_ideology_deaths_omicron[[7]])[[9]],summary(model_ideology_deaths_omicron[[8]])[[9]],summary(model_ideology_deaths_omicron[[9]])[[9]],summary(model_ideology_deaths_omicron[[10]])[[9]])

Omicron_R <- round(Omicron_R, 2)
Omicron_R <- as.data.frame(as.character(Omicron_R))

R2 <- cbind(Alpha_R, Delta_R, Omicron_R)
R2 <- as.data.frame(R2)

Alpha_R <- R2$`as.character(Alpha_R)`
Delta_R <- R2$`as.character(Delta_R)`
Omicron_R <- R2$`as.character(Omicron_R)`

 table <- dplyr::tibble(
   Regions = c("Region 10",   "Region 9",    "Region 8",    "Region 7",    "Region 6",    "Region 5",    "Region 4",    "Region 3",    "Regions 1-2"),
   Alpha = Alphax,
   AlphaR2 = Alpha_R,
   Delta = Deltax,
   DeltaR2 = Delta_R,
   Omicron = Omicronx,
   OmicronR2 = Omicron_R,
   Map= c("\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region10.png}",
           "\\includegraphics[valign = T,width=1.90cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region9.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region8.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region7.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region6.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region5.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region4.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region3.png}",
           "\\includegraphics[valign = T,width=2cm]{/mnt/ceph/erichs/git/IMCI-covid-riskfinal/region_pngs/region1.png}"))

 table <- table[rev(rownames(table)),]
 
sigtable <- knitr::kable(table, format = "latex",  escape = FALSE, booktabs=T) %>% column_spec(c(2,4,6), width = "1in") %>% column_spec(c(3,5,7), width = ".5in") %>% column_spec(8, width = ".5in") %>% kable_styling(full_width = FALSE, latex_options = "hold_position", font_size=8)
 
#sigtable <- knitr::kable(table, format = "latex", escape = FALSE, booktabs=T)
# sigtable <- table %>% kable() %>% arrange(Regions) %>% column_spec(1:5, width = "1in") %>% kable_styling(full_width = FALSE, latex_options = "hold_position")
# #
sigtable
#add_header_above(sigtable, c(" ", "Significant Independent Variables" = 4))









```